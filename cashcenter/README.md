# Cashcenter: Веб-сервис для управления движением денежных средств (ДДС)

![Python](https://img.shields.io/badge/Python-3.8%2B-blue)
![Django](https://img.shields.io/badge/Django-5.2.1-green)
![SQLite](https://img.shields.io/badge/SQLite-3.31%2B-lightgrey)
![Bootstrap](https://img.shields.io/badge/Bootstrap-5.3.0-blueviolet)

## Описание проекта

**Cashcenter** — это веб-приложение для учёта, управления и анализа движения денежных средств (ДДС). Оно позволяет пользователям вести учёт всех денежных операций с учётом различных параметров, таких как дата, статус, тип, категория, подкатегория, сумма и комментарий. Приложение разработано с использованием Django и SQLite, с кастомным интерфейсом на основе Bootstrap, а также возможностью управления через стандартную админ-панель Django.

### Основные возможности
- **Создание, редактирование и удаление записей ДДС**:
  - Поля: дата, статус (например, "Бизнес", "Личное", "Налог"), тип ("Пополнение", "Списание"), категория (например, "Маркетинг", "Инфраструктура"), подкатегория (например, "Farpost", "VPS"), сумма и комментарий.
- **Просмотр списка записей**:
  - Таблица с фильтрами по дате (период), статусу, типу, категории и подкатегории.
- **Управление справочниками**:
  - Добавление, редактирование и удаление статусов, типов, категорий и подкатегорий.
- **Логические зависимости**:
  - Подкатегории привязаны к категориям, категории — к типам.
  - Валидация: пользователь не может выбрать подкатегорию, если она не соответствует категории, или категорию, если она не соответствует типу.
- **Кастомный интерфейс**:
  - Использует Bootstrap 5.3.0 для стилизации.
  - Главная страница, страницы добавления/редактирования записей и управления справочниками.
- **Админ-панель Django**:
  - Полный доступ к данным через встроенную админку.

### Цели проекта
- Обеспечить удобное управление денежными операциями.
- Предоставить гибкость для расширения справочников (статусы, типы, категории, подкатегории).
- Создать интуитивно понятный интерфейс для пользователей.

## Требования

- **Python**: 3.8 или выше
- **Django**: 5.2.1
- **django-admin-rangefilter**: Для фильтрации по дате в админке
- **SQLite**: Используется по умолчанию (можно заменить на другую базу, например, PostgreSQL)
- **Bootstrap**: 5.3.0 (подключён через CDN)
- **jQuery**: 3.6.0 (подключён через CDN, используется для AJAX-запросов)

## Установка

Следуй этим шагам, чтобы установить и запустить проект локально.

### 1. Клонируй репозиторий
```bash
git clone https://github.com/Shadowgraph-1/cashflow
cd cashcenter
```

### 2. Создай и активируй виртуальное окружение
```bash
python -m venv env
source env/bin/activate  # Для Linux/Mac
env\Scripts\activate     # Для Windows
```

### 3. Установи зависимости
Убедись, что ты находишься в корневой директории проекта (`cashcenter`), и выполни:
```bash
pip install -r requirements.txt
```

### 4. Настрой базу данных
По умолчанию используется SQLite (`db.sqlite3`). Выполни миграции для создания базы данных:
```bash
python manage.py makemigrations
python manage.py migrate
```

### 5. Создай суперпользователя
Для доступа к админ-панели создай суперпользователя:
```bash
python manage.py createsuperuser
```
Следуй инструкциям: введи имя пользователя, email и пароль.

### 6. Собери статические файлы
Собери статические файлы для кастомного интерфейса:
```bash
python manage.py collectstatic
```

## Запуск

1. Запусти сервер разработки:
   ```bash
   python manage.py runserver
   ```

2. Открой в браузере:
   - **Кастомный интерфейс**: `http://127.0.0.1:8000/`
   - **Админ-панель**: `http://127.0.0.1:8000/admin/`

3. Войди в админку с учётной записью суперпользователя, чтобы управлять данными.

## Использование

### Кастомный интерфейс
- **Главная страница** (`/`): Просмотр списка записей ДДС с фильтрами.
- **Добавление записи** (`/add/`): Форма для создания новой записи с динамической фильтрацией подкатегорий.
- **Редактирование записи** (`/edit/<id>/`): Форма для редактирования существующей записи.
- **Удаление записи** (`/delete/<id>/`): Удаление записи.
- **Управление справочниками** (`/directories/`): Добавление, редактирование и удаление статусов, типов, категорий и подкатегорий.

### Админ-панель
- Доступна по адресу `/admin/`.
- Полное управление записями и справочниками.
- Фильтры по дате, статусу, типу, категории и подкатегории.
- Возможность массового редактирования и удаления.

### Пример использования
1. Войди в админку и добавь несколько статусов ("Бизнес", "Личное", "Налог"), типов ("Пополнение", "Списание"), категорий ("Маркетинг", "Инфраструктура") и подкатегорий ("Farpost", "VPS").
2. Перейди на главную страницу (`/`), нажми "Добавить запись", выбери параметры и сохрани.
3. Используй фильтры на главной странице для поиска нужных записей.

## Структура проекта

```
cashcenter/
├── cashcenter/                  # Основные настройки проекта
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
├── directories/                 # Приложение для справочников
│   ├── __init__.py
│   ├── admin.py
│   ├── models.py
│   ├── views.py
│   ├── migrations/
├── records/                     # Приложение для записей ДДС
│   ├── __init__.py
│   ├── admin.py
│   ├── models.py
│   ├── views.py
│   ├── migrations/
├── templates/                   # Шаблоны кастомного интерфейса
│   ├── base.html
│   └── records/
│       ├── index.html
│       ├── add_record.html
│       ├── edit_record.html
│       ├── manage_directories.html
├── static/                      # Статические файлы
│   ├── js/
│       ├── record_form.js
├── staticfiles/                 # Собранные статические файлы
├── manage.py                    # Управление проектом
├── .gitignore                   # Исключения для Git
├── requirements.txt             # Зависимости проекта
├── README.md                    # Документация
└── db.sqlite3                   # База данных SQLite
```

## Тестирование

### Тестирование функционала
1. **Создание записи**:
   - Перейди на `/add/`, заполни форму, выбери категорию и подкатегорию. Убедись, что подкатегории фильтруются автоматически.
2. **Фильтры**:
   - На главной странице (`/`) проверь фильтры по дате, статусу и типу.
3. **Валидация**:
   - Попробуй создать запись с некорректными данными (например, сумма <= 0, несоответствие категории и типа). Должны появляться ошибки.
4. **Админ-панель**:
   - Войди в админку, проверь фильтры и CRUD-операции.

### Автоматическое тестирование
На данный момент автоматические тесты не реализованы, но их можно добавить, создав файл `tests.py` в приложениях `records` и `directories`. Пример теста для проверки создания записи:

```python
from django.test import TestCase
from django.urls import reverse
from directories.models import Status, Type, Category, Subcategory
from records.models import Record

class RecordTests(TestCase):
    def setUp(self):
        self.status = Status.objects.create(name="Бизнес")
        self.type = Type.objects.create(name="Списание")
        self.category = Category.objects.create(name="Маркетинг", type=self.type)
        self.subcategory = Subcategory.objects.create(name="Farpost", category=self.category)

    def test_create_record(self):
        record = Record.objects.create(
            date="2025-01-01",
            status=self.status,
            type=self.type,
            category=self.category,
            subcategory=self.subcategory,
            amount=1000.00,
            comment="Тестовая запись"
        )
        self.assertEqual(record.amount, 1000.00)
        self.assertEqual(record.comment, "Тестовая запись")
```

Запусти тесты:
```bash
python manage.py test
```

## Разработка

### Технологии
- **Backend**: Python 3.8+, Django 5.2.1, SQLite
- **Frontend**: Bootstrap 5.3.0, jQuery 3.6.0
- **AJAX**: Используется для динамической фильтрации подкатегорий на основе выбранной категории.

### Добавление новых функций
1. **Новые модели**:
   - Добавь модель в `records/models.py` или `directories/models.py`.
   - Создай и примени миграции: `python manage.py makemigrations`, `python manage.py migrate`.
2. **Новые страницы**:
   - Создай шаблон в `templates/records/`.
   - Добавь представление в `records/views.py`.
   - Добавь маршрут в `cashcenter/urls.py`.
3. **Новые стили**:
   - Добавь CSS или JS в `static/css/` или `static/js/`.

### Возможные улучшения
- Добавить автоматические тесты.
- Реализовать авторизацию для кастомного интерфейса (сейчас используется админка).
- Добавить экспорт/импорт данных в CSV/Excel.
- Использовать PostgreSQL вместо SQLite для продакшена.

## Скриншоты

- **Главная страница**: [screenshots/main.png](screenshots/main.png)
- **Добавление записи**: [screenshots/add_note.png](screenshots/add_note.png)